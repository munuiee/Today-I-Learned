# 프로세스
실행중인 프로그램의 인스턴스
- iOS에서는 실행되는 앱을 프로세스라고 이해하면 된다.
- 앱이 실행되면, 운영 체제는 앱의 실행을 관리하기 위해서 프로세스를 생성함
- 프로세스는 자신만의 메모리 영역을 할당받고 앱의 실행상태를 관리함

<br>

# 메모리 구조
앱을 실행하면 운영체제가 메모리에 영역을 설정

![](https://velog.velcdn.com/images/jihyee10/post/fbb2ba3e-0196-4dc0-8181-0f6fbf9de33b/image.png)

<br>

### `code` 영역
우리가 작성한 코드는 컴파일 과정을 거쳐 기계어 형태(0과 1)로 변환되어 이 영역에 저장된다.
- CPU: 이 영역에 저장된 코드를 읽고 해당 작업 처리
- 프로그램 실행과 동시에 메모리에 할당되며, 프로그램이 종료되면 메모리에서 해제된다.
- `Read-Only(읽기전용)`으로 실행 중에는 변경 불가능

<br>

### `Data` 영역
`전역변수`와 `정적(static)변수`가 저장되는 메모리 영역
- 프로그램 실행 시 메모리에 할당되며, 프로그램 종료 시 메모리에서 해제됨
- 프로그램 실행 중에 변수 값이 변경될 수 있으므로 `Read-Write(읽기-쓰기 가능)`이다.


<br>


### `Heap` 영역
class 인스턴스나 클로저와 같은 `참조 타입(Reference Type)`의 데이터가 할당되는 동적 메모리 영역
- 이 영역의 메모리 크기는 런타임에 결정되며, 확정되지 않은 크기의 데이터가 저장된다.
- `ARC`를 통해서 메모리 관리가 자동으로 이루어짐
	
    - 개발자는 메모리 누수에 주의
    - 자동으로 관리하지만 관리를 해야함
    
- 메모리에 할당되고 해제되는 과정이 상대적으로 느림

<br>

### `Stack` 영역
함수 호출 시 생성되는 지역변수, 매개변수, 리턴값 등이 저장됨
- 일반적으로 `값 타입(value type)`의 데이터가 저장됨
- 함수가 종료되면 자동으로 메모리에서 해제
- 메모리 할당 및 해제의 속도가 `Heap` 영역보다 빠름
- `컴파일 시점`에 해당 영역의 메모리 크기가 결정됨
- Stack 메모리는 크기가 제한되어 있어, 이를 초과하면 스택 오버플로우(Stack Overflow) 오류가 발생하여 프로그램이 종료될 수 있다.
<br>

[데이터 타입 정리](https://github.com/munuiee/Today-I-Learned/blob/main/Swift/데이터타입.md)

<br>

# `Copy On Write`
메모리 효율을 위해서 `value type`의 인스턴스를 다른 값에 할당하거나 파라미터로 전달할 때 값이 변경되기 전까지는 실제로 복사하지 않는 것

```swift

// 메모리를 확이하는 함수
/*
func address(of object: UnsafeRawPointer) -> String {
	let address = Int(bitPattern: object)
    return String(format: "%p", address)
}
*/

func address(of Object: UnsafeRawPointer) -> String {
	return String(describing: object) // 포인터 주소를 문자열로 출력
}

var a = [1, 2, 3]
var b = a

print(address(of: &a)) // 0x60000171d6a-
print(address(of: &b)) // 0x60000171d6a0

// 똑같은 주소 값
// 값을 작성하기 전까지는 동일한 메모리를 사용한다.

b.apeend(100)
print(address(of: &a)) // 0x60000171d6a0
print(address(of: &b)) // 0x6000021014c0

/* b 배열에 값을 작성하면 그때 메모리를 복사
-> 메모리 효율을 높일 수 있다.
WRITE 하기 전까지는 쓸모없는 메모리를 사용하지 않는다. */

var c = a
c = [1, 2, 3]

print(address(of: &a)) // 0x6000171d6a0
print(address(of: &c)) // 0x6000170d920 // 동일한 값을 넣었어도 값을 수정한 것이기 때문에 새로운 주소값이 나옴
```
